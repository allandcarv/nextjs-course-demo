{"ast":null,"code":"import _defineProperty from \"/Users/allan.carvalho/workspace/courses/react/complete-guide/section-23_next-js/nextjs-project/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"/Users/allan.carvalho/workspace/courses/react/complete-guide/section-23_next-js/nextjs-project/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/allan.carvalho/workspace/courses/react/complete-guide/section-23_next-js/nextjs-project/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { MongoClient, ObjectId } from 'mongodb';\n\nvar connection = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(collection) {\n    var client, db, conn;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            client = new MongoClient('mongodb+srv://react-course:react-course-pass@cluster0.7s65w.mongodb.net/meetups?retryWrites=true&w=majority');\n            _context.next = 3;\n            return client.connect();\n\n          case 3:\n            db = client.db();\n            conn = db.collection(collection);\n            return _context.abrupt(\"return\", {\n              conn: conn,\n              client: client\n            });\n\n          case 6:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function connection(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexport var find = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(collection, property) {\n    var _yield$connection, conn, client, params, result;\n\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return connection(collection);\n\n          case 2:\n            _yield$connection = _context2.sent;\n            conn = _yield$connection.conn;\n            client = _yield$connection.client;\n            params = property && ({}, _defineProperty({}, property, 1));\n            _context2.next = 8;\n            return conn.find(params).toArray();\n\n          case 8:\n            result = _context2.sent;\n            client.close();\n            return _context2.abrupt(\"return\", result);\n\n          case 11:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function find(_x2, _x3) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexport var findOne = /*#__PURE__*/function () {\n  var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(collection, filter) {\n    var _yield$connection2, conn, client, parsedFilter, result;\n\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return connection(collection);\n\n          case 2:\n            _yield$connection2 = _context3.sent;\n            conn = _yield$connection2.conn;\n            client = _yield$connection2.client;\n            parsedFilter = Object.keys(filter).reduce(function (_final, key) {\n              if (key === '_id') {\n                _final[key] = new ObjectId(filter[key]);\n              } else {\n                _final[key] = filter[key];\n              }\n\n              return _final;\n            }, {});\n            _context3.next = 8;\n            return conn.findOne(parsedFilter).toArray();\n\n          case 8:\n            result = _context3.sent;\n            client.close();\n            return _context3.abrupt(\"return\", result);\n\n          case 11:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function findOne(_x4, _x5) {\n    return _ref4.apply(this, arguments);\n  };\n}();","map":{"version":3,"sources":["/Users/allan.carvalho/workspace/courses/react/complete-guide/section-23_next-js/nextjs-project/shared/util/db.js"],"names":["MongoClient","ObjectId","connection","collection","client","connect","db","conn","find","property","params","toArray","result","close","findOne","filter","parsedFilter","Object","keys","reduce","final","key"],"mappings":";;;AAAA,SAASA,WAAT,EAAsBC,QAAtB,QAAsC,SAAtC;;AAEA,IAAMC,UAAU;AAAA,sEAAG,iBAAOC,UAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AACTC,YAAAA,MADS,GACA,IAAIJ,WAAJ,CAAgB,6GAAhB,CADA;AAAA;AAAA,mBAGTI,MAAM,CAACC,OAAP,EAHS;;AAAA;AAKTC,YAAAA,EALS,GAKJF,MAAM,CAACE,EAAP,EALI;AAOTC,YAAAA,IAPS,GAOFD,EAAE,CAACH,UAAH,CAAcA,UAAd,CAPE;AAAA,6CASR;AAAEI,cAAAA,IAAI,EAAJA,IAAF;AAAQH,cAAAA,MAAM,EAANA;AAAR,aATQ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAVF,UAAU;AAAA;AAAA;AAAA,GAAhB;;AAYA,OAAO,IAAMM,IAAI;AAAA,uEAAG,kBAAOL,UAAP,EAAmBM,QAAnB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACeP,UAAU,CAACC,UAAD,CADzB;;AAAA;AAAA;AACRI,YAAAA,IADQ,qBACRA,IADQ;AACFH,YAAAA,MADE,qBACFA,MADE;AAGVM,YAAAA,MAHU,GAGDD,QAAQ,KAAK,wBAAOA,QAAP,EAAkB,CAAlB,CAAL,CAHP;AAAA;AAAA,mBAKKF,IAAI,CAACC,IAAL,CAAUE,MAAV,EAAkBC,OAAlB,EALL;;AAAA;AAKVC,YAAAA,MALU;AAOhBR,YAAAA,MAAM,CAACS,KAAP;AAPgB,8CASTD,MATS;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAJJ,IAAI;AAAA;AAAA;AAAA,GAAV;AAYP,OAAO,IAAMM,OAAO;AAAA,uEAAG,kBAAOX,UAAP,EAAmBY,MAAnB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACYb,UAAU,CAACC,UAAD,CADtB;;AAAA;AAAA;AACXI,YAAAA,IADW,sBACXA,IADW;AACLH,YAAAA,MADK,sBACLA,MADK;AAGbY,YAAAA,YAHa,GAGEC,MAAM,CAACC,IAAP,CAAYH,MAAZ,EAAoBI,MAApB,CAA2B,UAACC,MAAD,EAAQC,GAAR,EAAgB;AAC5D,kBAAIA,GAAG,KAAK,KAAZ,EAAmB;AACfD,gBAAAA,MAAK,CAACC,GAAD,CAAL,GAAa,IAAIpB,QAAJ,CAAac,MAAM,CAACM,GAAD,CAAnB,CAAb;AACH,eAFD,MAEO;AACHD,gBAAAA,MAAK,CAACC,GAAD,CAAL,GAAaN,MAAM,CAACM,GAAD,CAAnB;AACH;;AAED,qBAAOD,MAAP;AACH,aARoB,EAQlB,EARkB,CAHF;AAAA;AAAA,mBAaEb,IAAI,CAACO,OAAL,CAAaE,YAAb,EAA2BL,OAA3B,EAbF;;AAAA;AAabC,YAAAA,MAba;AAenBR,YAAAA,MAAM,CAACS,KAAP;AAfmB,8CAiBZD,MAjBY;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAPE,OAAO;AAAA;AAAA;AAAA,GAAb","sourcesContent":["import { MongoClient, ObjectId } from 'mongodb';\n\nconst connection = async (collection) => {\n    const client = new MongoClient('mongodb+srv://react-course:react-course-pass@cluster0.7s65w.mongodb.net/meetups?retryWrites=true&w=majority')\n\n    await client.connect();\n\n    const db = client.db();\n\n    const conn = db.collection(collection);\n\n    return { conn, client };\n}\n\nexport const find = async (collection, property) => {\n    const { conn, client } = await connection(collection);\n\n    const params = property && ({}, { [property]: 1 } );\n\n    const result = await conn.find(params).toArray();\n\n    client.close();\n\n    return result;\n}\n\nexport const findOne = async (collection, filter) => {\n    const { conn, client } = await connection(collection);\n\n    const parsedFilter = Object.keys(filter).reduce((final, key) => {\n        if (key === '_id') {\n            final[key] = new ObjectId(filter[key]);\n        } else {\n            final[key] = filter[key]\n        }\n\n        return final;\n    }, {}) \n\n    const result = await conn.findOne(parsedFilter).toArray();\n\n    client.close();\n\n    return result;\n}"]},"metadata":{},"sourceType":"module"}